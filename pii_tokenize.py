import sys
sys.path.append('/home/sayi/workspace/pii/I_want_PII_NER/res')
print(sys.path)
from res.labling_tool import *
import re
from res.Sentence import Sentence

root_path = '/home/sayi/workspace/pii/'
project_path = root_path + 'I_want_PII_NER/'
file_path = 'res/intergrated_sangheon.tsv'
file_path = "res/filling.kt"
file_path = "new_one.tsv"
file_path = "res/spacing_case.tsv"
file_path = "res/kssed.tsv"
out_file = "res/duplabeld.tsv"

PRE = "pre"
POST = "post"
LEARNING = "learning"
PREDICT = "predict"
  
unclassified_set = set([])
other_set = set(['ìœ¼ë¡œ', 'ë²ˆìœ¼ë¡œ', 'ì„¸ë¡œ', '-ë²ˆìœ¼ë¡œ', ')ìœ¼ë¡œ', ')ë¡œ', '-ìœ¼ë¡œ', 'ëŒ€ë¡œ', 'ë§žìœ¼ì‹­ë‹ˆê¹Œ?', 'ë§žìŠµë‹ˆê¹Œ?', 'ë§žìœ¼ì‹ ê°€ìš”?', 'ë§žë‚˜ìš”?', 'ê³„ì¢ŒëŠ”', 'ê³ ê°ì½œì„¼í„°(', 'ê³ ê°ì„¼í„°(', 'ë³´ìƒì½œì„¼í„°(', 'ì½œì„¼í„°(', 'ëŒ€', 'ì´ì—ˆëŒ€', 'ëŒ€ë‹¤.', 'ìž„', 'ìž„ì„', 'ìž„?', 'ì‚¬ê³ ì‹ ê³ ', '/ê°œì‹ êµ)ì˜', 'ì‹ ëª¨(', 'ì‹ ê°€ìš”', 'í•„ì§€', 'ìµœëª¨(', 'ì´ë¦¬(', 'ì¶©ì¸', 'íƒœí‰', 'í‹€ëª»', 'í‰í™”ì£¼ê³µ', 'í’ë‚©', 'í•˜êµ¬', 'í•˜ëŠ”ë°...'])
not_other = set([
    # address ì•„íŒŒíŠ¸, ë¡œ, ë™, í˜¸, ë§ˆì„, ê¸¸, ë²ˆì§€, ì—­, íƒ€ì›Œ, ì¸µ, ì‹œí‹°, ìŒ, ëŒ€, ì‚°, ë°¸ë¦¬, ë¹Œë”©, ë¡¯ë°, ë‹¨ì§€, ì§€í•˜, ë°©, ì¹´íŽ˜, ì‹ ,
    'í•œì†”ì„¼íŠ¸ëŸ´íŒŒí¬', 'ì°¨ì•„íŒŒíŠ¸ì§€ì ', 'ë‹¨ì§€ì•„íŒŒíŠ¸ì•„íŒŒíŠ¸', 'ì°¨ì•„íŒŒíŠ¸', 'ìƒê³„ì£¼ê³µì•„íŒŒíŠ¸', 'ë‹¨ì§€ì•„íŒŒíŠ¸', 'ê°€í˜„ëŒ€ì•„íŒŒíŠ¸', 'ì°¨ì•„íŒŒíŠ¸ìž…ë‹ˆê¹Œ?', 'ì°¨e-íŽ¸í•œì„¸ìƒì•„íŒŒíŠ¸', 'ë¦¬ì„ ëª…ì•„íŒŒíŠ¸',
     'ê´€ê´‘ë¡œ', 'ì˜¬ë¦¼í”½ë¡œ', 'ë°©ë°°ì²œë¡œ', 'ë™ì†Œë¬¸ë¡œ', 'ë¶€ì¼ë¡œ', 'ë‹µì‹­ë¦¬ë¡œ', 'ìˆ˜í‘œë¡œ', 'ì—°ì„œë¡œ', 'ì‹ í¥ë¡œ', 'ë°©ì¶•ë¡œ',  'ë©”íŠ¸ë¡œíŒ”ë ˆìŠ¤', 'ë‹¹ì‚°ë¡œ', 'í–‰ì›ë¡œ', 'ë¶ì„±ë¡œ', 'ì•ˆì‚°ì²œë™ë¡œ', 'ì„¤ì´Œë¡œ', 'íƒœë³µì‚°ë¡œ', 'í†µì¼ë¡œ', 'ì„œë™ë¡œ', 'ê´‘êµì¤‘ì•™ë¡œ', 'ë¶€ì‚°ëŒ€í•™ë¡œ', 'ê¹€í¬ëŒ€ë¡œ', 'ì°½í›ˆë¡œ', 'ë´‰ëª…ë¡œ', 'ì„œì´ˆëŒ€ë¡œ', 'í‘¸ë¥¸ë“¤íŒë¡œ', 'ê°í¬ë¡œ', 'ì¤‘ì•™ë¡œ', 'ì„œë‘”ë¡œ', 'ë‚¨ë¶€ìˆœí™˜ë¡œ', 'ê°•ë‚¨ëŒ€ë¡œ', 'ì–¸ì£¼ë¡œ', 'ë™íŽ¸ë¡œ', 'ì‚°ë³¸ë¡œ', 'ì›”ê³„ë¡œ', 'ì²œë„ë¡œ', 'ì‚°ì„±ë¡œ', 'í•™ì‚°ë¡œ', 'í˜¸ë¡œ', 'ì—¬ì˜ëŒ€ë°©ë¡œ', 'ì¡°ë§ˆë£¨ë¡œ', 'ìš´ì²œë¡œ', 'ë™ìœ¼ë¡œ', 'ì‚°ë³¸ì²œë¡œ', 'ë²ˆê¸¸ë¡œ', 'ëŒ€ë¦¼ë¡œ', 'ë™ì¼ë¡œ', 'í‰ì´ŒëŒ€ë¡œ', 'í˜¸êµ­ë¡œ', 'ê°€ëžŒë¡œ', 'ì†Œì–‘ë¡œ', 'ê³ ì‚°ìžë¡œ', 'êµ°ë¶„ë¡œ', 'ì²œí˜œë¡œ', 'ë§Œë¦¬ì‚°ë¡œ', 'ìƒ‰ë‹¬ë¡œ', 'íšŒê¸°ë¡œ', 'ì°½í•´ë¡œ', 'ì¶©ìž¥ë¡œ', 'ë™íŒ¨ë¡œ', 'ì¹ ì‹­íŒ”í‚¤ë¡œ', 'ë™ê³„ì²œë¡œ', 'ë…ì •ì´ë¡œ', 'ì™€ìš°ì‚°ë¡œ', 'ì–‘í™”ë¡œ', 'ì¶©ë¬´ë¡œ', 'ë©”íƒ€í”„ë¡œë°©ìŠ¤', 'ì „í¬ëŒ€ë¡œ', 'ê¸¸ë¡œ', 
     'ë™ì—­ì—ì„œ', 'ì‚¼ì„ ë™', 'ë™', 'ë™ë§žìŠµë‹ˆê¹Œ?', 'ë™ì´ìš”.', 'ì–‘í‰ë™', 'ë…¸ì›ë™', 'ëª…ë™', 'ë™ì§€ì ', 'ë™,', 'í‰í™”ë™', 'ë‹¹ì‚°ë™', 'íš¨ìžë™', 'ìžì‚°ë™', 
    'ì›”ê³„ì‚¼í˜¸', 'í˜¸ìž…ë‹ˆë‹¤.', 'í˜¸í˜¸ìš”.', 'í•­í˜¸', 'ìš©í˜¸', 'í˜¸ìž…ë‹ˆë‹¤', 'í˜¸ê³„ë§¤ê³¡', 'ê¸ˆí˜¸ì‚°', 'í˜¸ì„ ', 'í˜¸.', 'í˜¸,', 'ì²œí˜¸', 'í˜¸ìš”.', 'í˜¸', '(ìš©í˜¸', 'í˜¸ì´ê³ ', 'ì‚°í˜¸ê·¸ë¦°',
    'ì‚°ë‚´ë§ˆì„', 'ì€ë¹›ë§ˆì„', 'ìž¥ìž¬ë¦¬ìš©ì—°ë§ˆì„íœ´ë¨¼ì‹œì•„', 'ì¤‘ì‚°ë§ˆì„', 'ë°±ë§ˆë§ˆì„', 'ì²­ì†¡ë§ˆì„í˜„ëŒ€',
    'í•˜ì˜¤ê°œê¸¸', 'ìž¥ë•ë¶ê¸¸', 'ê¸¸', 'ë‚˜ê¸¸', 'ì•ˆê¸¸', 'ë²ˆê¸¸', 'ì‚°ì–‘í°ê¸¸', 'ë²ˆê¸¸ìž…ë‹ˆë‹¤.', 'ê¸¸ë§žìŠµë‹ˆê¹Œ?', 'ê°€ê¸¸', 'ì‹ ê¸¸', 'ê¸¸ìš”.', 'ë²ˆê¸¸ì—ì„œ', 'ë²ˆì•ˆê¸¸', 'ë¼ê¸¸', 'í™”ì„±ê¸¸', 
    'ë²ˆì§€ë¼', 'ë²ˆì§€,', 'ë²ˆì§€', 'ë²ˆì§€ìž…ë‹ˆë‹¤.', 'ë²ˆì§€ëŠ”', 'ë²ˆì§€.', 'ë²ˆì§€ìš”.',
    'ì‹œì½”ë¥´í”Œëž˜ê·¸ì‹­ê°•ë‚¨ì—­ì (ê°•ë‚¨ì—­',
    'ì—ì´ìŠ¤í•˜ì´ì—”ë“œíƒ€ì›Œ', 'ì´ì•¤ì”¨ë²¤ì³ë“œë¦¼íƒ€ì›Œ',
    'ì¸µ)', 'ì¸µ!!', 'ì¸µì´ìš”.', 'ì¸µìž…ë‹ˆë‹¤.', 'ì¸µì—', 'ì¸µ.', 'ì¸µìž…ë‹ˆë‹¤!', 'ì¸µ,', 'ì¸µ', 'ì¸µìœ¼ë¡œ',
    'ë§ˆë¦°ì‹œí‹°',
    'ìŒìš©ì•„ì§„', 'ìŒë¬¸', 'ìŒìš©',
    'ëŒ€ì—°', 'í˜„ëŒ€', 'ë°±ì„ì˜ˆëŒ€', 'ë‹¤ëŒ€', 'ëŒ€ìš°ë””ì˜¤ìŠˆíŽ˜ë¦¬ì›€', 'ëŒ€ì €', 'ëŒ€ëŠ¥', 'ì´í™”ì—¬ëŒ€', 'ëŒ€ëª…',
    'ë‹¹ì‚°', 'ë…ì‚°', 'ìš©ì‚°', 'ì‚°', 'ì—°ì‚°', 'ì² ì‚°', 'ì†¡ë‹¹ë¦¬ì‚°', 'ë‚™ì‚°ì„±ê³½ì„œ',
    'ìš°ë¦¼ë¼ì´ì˜¨ìŠ¤ë°¸ë¦¬',
    'ë…¸ë¸”ë ˆìŠ¤ë¹Œë”©',
    'ë¡¯ë°', 'ë¡¯ë°ì¸ë²¤ìŠ¤',
    'ì°¨ë‹¨ì§€', 'ë‹¨ì§€', 'ìœ í†µë‹¨ì§€',
    'ì§€í•˜',
    'ìš°ë°©', 'êµë°©ë‚¨', 'ë°©í™”', 'ë°©ë°°',
    'ì¹´íŽ˜',
    'ì‹ ì„¤', 'ì‹ ì•”', 
    'ë•ëª…', 'í’ë•ì²œ',



    # age ì‚´, ì„¸, ê°œì›”
    'ì‚´ì´ê³ ,', 'ì‚´ë°–ì—', 'ì‚´ì˜', 'ì‚´ì´ë‹¤', 'ì‚´ì´êµ¬ìš”..', 'ì‚´ì´ìž–ì•„!', 'ì‚´ì´ë¼ë‹ˆ', 'ì‚´ë§Žë‹¤', 'ì‚´...', 'ì‚´ì´ëž˜..', 'ì‚´ì´ë‹¤.', 'ì‚´ì¸ë°', 'ì‚´ì´ë¼ë©°', 'ì‚´', 'ì‚´ì´ê³ ', 'ì‚´ì´ë‹ˆ', 'ì‚´!!', 'ì‚´ì´ë˜ì–´', 'ì‚´ì¸ê°€?', 'ì‚´ì´ë¼ê³ ', 'ì‚´ì¸', 'ì‚´ì´ìž–ì•„', 'ì‚´!', 'ì‚´ì—', 'ì‚´ì´ì§€ë§Œ', 'ì‚´ì´ë‹ˆê¹Œ', 'ì‚´ì´ë©´', 'ì‚´?', 'ì‚´...ã…‹', 'ì‚´ìž…ë‹ˆë‹¤.', 'ì‚´ì´ë¼', 'ì‚´ì´', 'ì‚´..', 'ì‚´.', 'ì‚´,', 'ì‚´ì€', 'ì‚´ì´ì—ìš”~', 'ì‚´ì§œë¦¬',
    'ì„¸,', 'ì„¸ë¥¼', 'ì„¸ë¼ê³ ?', 'ì„¸ìž…ë‹ˆë‹¤.', 'ì„¸)ì˜', 'ì„¸â˜†)', 'ì„¸ì¸ë°ë„!!!', 'ì„¸,ë°•ì‚¬)', 'ì„¸ìž„,', 'ì„¸ì¸', 'ì„¸ì•¼', 'ì„¸ë©´', 'ì„¸),', 'ì„¸ì˜', 'ì„¸ë‹¤.', 'ì„¸ëŠ”', 'ì„¸.', 'ì„¸)', 'ì„¸ì—', 'ì„¸ê°€', 'ì„¸)ì™€', 'ì„¸ë¼ëŠ”', 'ì„¸', 'ì„¸ëœ', 'ì„¸ë˜ì‹ ', 'ì„¸)ê°€', 'ì„¸ì—ë„', 'ì„¸ì™€', 'ì„¸)ë¡œ',
    'ê°œì›”ì•„ê¸°', 'ê°œì›”', 'ê°œì›”ì¸', 'ê°œì›”ì´ê³ ', 'ê°œì›”ì—', 'ê°œì›”ì ‘ì–´ì„ ',

    # weight
    'í‚¤ë¡œ', 'í‚¬ë¡œë¼ë‹ˆ.', 'í‚¬ë¡œ', 'kg', 'KG', 'Kg',
    # length
    "ì„¼í‹°", "ì„¼í‹°", "ì„¼ì¹˜", "cm",
    # birth ì¼, ë…„, ì›”
    'ì¼ìž…ë‹ˆë‹¤.', 'ì¼!', 'ì¼>', 'ì¼ì´', 'ì¼..', 'ì¼ë‚ ', 'ì¼ì´ë¼', 'ì¼ì´ì—‡ëŠ”ëŽ€', 'ì¼?', 'ì¼', 'ì¼ìƒ', 'ì¼!!', 'ì¼ì€', 'ì¼ìž…ë‹ˆë‹¤', 'ì¼ì¸ë°', 'ì¼,', 'ì¼ë„', 'ì¼ì´ë”êµ¬ë§Œìš”', 'ì¼ì´ì•¼?', 'ì¼ì—', 'ì¼ê±°', 'ì¼ì´ìš”', 'ì¼ì•„ë‹ˆì•¼?', 'ì¼ì´ì•¼', 'ìƒì¼ì¸ë°', 'ì¼ì´ìš”.',
    'ë…„', 'ë…„ì—', 'ë…„ìƒ',
    'ì›”,', 'ì›”', 'ì›”í‰', 'ì›”.....?',

    # ë²ˆ
    'ë²ˆìž…ë‹ˆë‹¤', 'í•™ë²ˆ', 'ë²ˆì´ìš”.', 'ë²ˆìš”.', 'ë²ˆë•', 'ë²ˆì´ìš”', 'ë²ˆê°€', 'ë²ˆì¶œêµ¬',

    # etc
    'í•˜ì•ˆ', 'í•œí™”', 'í•©í¬ë¶', 'í–‰ë‹¹', 'í™ì€', 'í™©ê¸ˆ', 'íš¨ìž', 'íœ˜ê²½',
    
])
should_check = set([
    'ë¡œ', 'ë²ˆ'
])
few_cases = set(['ìžì–‘', 'ìž¥ê¸°', 'ìž¥ë¦¼', 'ìž¥ìœ„', 'ìž¥ì „', 'ì „ì›', 'ì •ë¦‰', 'ì •ì„œì§„', 'ì •ì™•', 'ì œ', 'ì£¼ê°„', 'ì£¼ë¡€', 'ì£¼ë©´', 'ì£¼ì•ˆ', 'ì£½ë„ì‹œìž¥', 'ì¤‘', 'ì¤‘ê³„', 'ì¤‘ê³¡', 'ì§€ë§‰', 'ì§„ìž…ì„', 'ì¨œ', 'ìª½êµ¬ë¦„', 'ì°¨', 'ì°¨ë§¨ì…˜', 'ì°½', 'ì±…í–¥ê¸°ë¡œ', 'ì²­í‰', 'ì²´ìœ¡ê´€'])
wait = set([])
def add_subword(spaced_tokens):
    for token in spaced_tokens:
        if not token.isnumeric() :
            if "ì´" in token and token not in other_set.union(not_other):
                wait.add(token)
            elif token not in other_set.union(not_other):
                unclassified_set.add(token)
            if token in few_cases:
                print(f'{token}ðŸ‘©â€ðŸ¦³ in ')

def spacing(pattern, token, mode):
    searched = re.compile(pattern).search(token)
    while searched:
        searched = searched.group()
        index = token.find(searched) + 1
        if mode == POST:
            index += len(searched) - 2
        token = token[:index] + ' ' + token[index:]
        # print(f"{mode} {searched} space at {index} in {token}")
        searched = re.compile(pattern).search(token)
    return token

def spacing_until_unsearched(sentence, mode=LEARNING):
    for i, token in enumerate(sentence.tokens):
        sapced_token = spacing('[^\s\d]\d+', token, PRE)
        sapced_token = spacing('\d+[^\s\d]', sapced_token, POST)
        sapced_token = spacing('((í‚¤ë¡œ)|(ë…„ìƒ)|(Kg)|(KG)|(kg)|(cm)|(ì„¼í‹°)|(ì„¼ì¹˜))\S', sapced_token, POST)
        if sapced_token == token:
            sentence.new_tokens.append(token)
        else:
            spaced_tokens = sapced_token.split()
            if sentence.labels[i] != 'O':
                add_subword(spaced_tokens)
            if mode == LEARNING:
                sentence.duplicate_labels(i, spaced_tokens)
                # print(i, sentence.labels)
            sentence.append_new_tokens(spaced_tokens)
    is_valid_lable(sentence.labels, sentence.new_tokens)

with open(file_path, 'r', encoding='UTF-8') as res_file, open(out_file, "w", encoding="utf-8") as edited_file:
    sentences = []
    for i, line in enumerate(res_file):
        # if i > 20:
            # break
        tokens, labels = splitTokenAndLable(line)
        sentence = Sentence(tokens, labels)
        sentences.append(sentence)
        spacing_until_unsearched(sentences[-1])
        edited_file.write(sentence.get_new_line())
    unclassified_set = sorted(list(unclassified_set))
    print(unclassified_set)
    print(wait)